<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Frontend</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        input[type="url"] { width: 300px; padding: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .loading { display: none; color: #666; }
        .results { display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç Frontend Accessibility Evaluator</h1>
    
    <form id="testForm">
        <div class="form-group">
            <label for="url">URL –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:</label><br>
            <input type="url" id="url" value="https://example.com" required>
        </div>
        <button type="submit" id="submitBtn">–¢–µ—Å—Ç—É–≤–∞—Ç–∏</button>
    </form>
    
    <div id="loading" class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    <div id="results" class="results"></div>
    
    <script>
        function formatKeyboardDetails(keyboardData) {
            if (!keyboardData) {
                return '<p>‚ùå –î–∞–Ω—ñ –ø—Ä–æ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω—É –Ω–∞–≤—ñ–≥–∞—Ü—ñ—é –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ</p>';
            }
            
            let html = `
                <p><strong>üìä –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong></p>
                <ul>
                    <li>–î–æ—Å—Ç—É–ø–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤: ${keyboardData.accessible_elements || 0}</li>
                    <li>–ó–∞–≥–∞–ª—å–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤: ${keyboardData.total_elements || 0}</li>
                    <li>–ü–æ—è—Å–Ω–µ–Ω–Ω—è —Å–∫–æ—Ä—É: ${keyboardData.score_explanation || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}</li>
                </ul>
            `;
            
            // –î–æ—Å—Ç—É–ø–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
            if (keyboardData.accessible_elements_list && keyboardData.accessible_elements_list.length > 0) {
                html += `
                    <p><strong>‚úÖ –î–æ—Å—Ç—É–ø–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ (${keyboardData.accessible_elements_list.length}):</strong></p>
                    <ul>
                `;
                keyboardData.accessible_elements_list.forEach((element, index) => {
                    html += `
                        <li>
                            <strong>–°–µ–ª–µ–∫—Ç–æ—Ä:</strong> ${element.selector || '–Ω–µ–≤—ñ–¥–æ–º–æ'}<br>
                            <strong>–ü—Ä–∞–≤–∏–ª–æ:</strong> ${element.rule || '–Ω–µ–≤—ñ–¥–æ–º–æ'}<br>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> ${element.status || '–î–æ—Å—Ç—É–ø–Ω–∏–π –∑ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏'}<br>
                            <strong>HTML:</strong> <code>${(element.html || '').substring(0, 100)}${element.html && element.html.length > 100 ? '...' : ''}</code>
                        </li>
                    `;
                });
                html += '</ul>';
            }
            
            // –ü—Ä–æ–±–ª–µ–º–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
            if (keyboardData.problematic_elements && keyboardData.problematic_elements.length > 0) {
                html += `
                    <p><strong>‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ (${keyboardData.problematic_elements.length}):</strong></p>
                    <ul>
                `;
                keyboardData.problematic_elements.forEach((element, index) => {
                    html += `
                        <li>
                            <strong>–°–µ–ª–µ–∫—Ç–æ—Ä:</strong> ${element.selector || '–Ω–µ–≤—ñ–¥–æ–º–æ'}<br>
                            <strong>–ü—Ä–∞–≤–∏–ª–æ:</strong> ${element.rule || '–Ω–µ–≤—ñ–¥–æ–º–æ'}<br>
                            <strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> ${element.issue || '–ü—Ä–æ–±–ª–µ–º–∞ –∑ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω–æ—é –Ω–∞–≤—ñ–≥–∞—Ü—ñ—î—é'}<br>
                            <strong>HTML:</strong> <code>${(element.html || '').substring(0, 100)}${element.html && element.html.length > 100 ? '...' : ''}</code>
                        </li>
                    `;
                });
                html += '</ul>';
            }
            
            if (keyboardData.accessible_elements === 0 && keyboardData.total_elements === 0) {
                html += '<p>‚ö†Ô∏è –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –¥–ª—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω–æ—ó –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>';
            }
            
            return html;
        }
        
        function formatErrorSupportDetails(errorData) {
            if (!errorData) {
                return '<p>‚ùå –î–∞–Ω—ñ –ø—Ä–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –ø–æ–º–∏–ª–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ</p>';
            }
            
            let html = `
                <p><strong>üìä –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong></p>
                <ul>
                    <li>–í—Å—å–æ–≥–æ —Ñ–æ—Ä–º: ${errorData.total_forms || 0}</li>
                    <li>–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏—Ö —Ñ–æ—Ä–º: ${errorData.supported_forms || 0}</li>
                    <li>–ü–æ—è—Å–Ω–µ–Ω–Ω—è —Å–∫–æ—Ä—É: ${errorData.score_explanation || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}</li>
                    <li>–¢–∏–ø –∞–Ω–∞–ª—ñ–∑—É: ${errorData.analysis_type === 'hybrid' ? 'üîÑ –ì—ñ–±—Ä–∏–¥–Ω–∏–π (—Å—Ç–∞—Ç–∏—á–Ω–∏–π + –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π)' : 
                                      errorData.analysis_type === 'static_only' ? 'üìä –¢—ñ–ª—å–∫–∏ —Å—Ç–∞—Ç–∏—á–Ω–∏–π' : 
                                      '‚ùì –ù–µ–≤—ñ–¥–æ–º–∏–π'}</li>
                    ${errorData.dynamic_tests_count ? `<li>–î–∏–Ω–∞–º—ñ—á–Ω–∏—Ö —Ç–µ—Å—Ç—ñ–≤: ${errorData.dynamic_tests_count}</li>` : ''}
                </ul>
            `;
            
            // –§–æ—Ä–º–∏ –∑ —Ö–æ—Ä–æ—à–æ—é –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é
            if (errorData.supported_forms_list && errorData.supported_forms_list.length > 0) {
                html += `
                    <p><strong>‚úÖ –§–æ—Ä–º–∏ –∑ —Ö–æ—Ä–æ—à–æ—é –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –ø–æ–º–∏–ª–æ–∫ (${errorData.supported_forms_list.length}):</strong></p>
                `;
                errorData.supported_forms_list.forEach((form, index) => {
                    const formSelector = form.selector || 'form';
                    const qualityScore = (typeof form.quality_score === 'number' && !isNaN(form.quality_score)) 
                        ? (form.quality_score * 100).toFixed(1) 
                        : '0.0';
                    
                    html += `
                        <div style="margin: 15px 0; padding: 15px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #27ae60;">
                            <h5 style="margin: 0 0 10px 0; color: #27ae60;">üìã ${formSelector}</h5>
                            <p><strong>–ó–∞–≥–∞–ª—å–Ω–∞ —è–∫—ñ—Å—Ç—å:</strong> ${qualityScore}%</p>
                    `;
                    
                    // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–æ–∑–±–∏–≤–∫—É —Å—Ç–∞—Ç–∏—á–Ω–∏–π/–¥–∏–Ω–∞–º—ñ—á–Ω–∏–π —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–æ
                    if (form.static_quality !== undefined || form.dynamic_quality !== undefined) {
                        html += `<div style="margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 4px;">`;
                        if (form.static_quality !== undefined) {
                            html += `<span style="margin-right: 15px;">üìä –°—Ç–∞—Ç–∏—á–Ω–∏–π: ${(form.static_quality * 100).toFixed(1)}%</span>`;
                        }
                        if (form.dynamic_quality !== undefined) {
                            html += `<span>üß™ –î–∏–Ω–∞–º—ñ—á–Ω–∏–π: ${(form.dynamic_quality * 100).toFixed(1)}%</span>`;
                        } else if (form.dynamic_error) {
                            html += `<span style="color: #e74c3c;">‚ùå –î–∏–Ω–∞–º—ñ—á–Ω–∏–π: ${form.dynamic_error}</span>`;
                        }
                        html += `</div>`;
                    }
                    
                    html += `<p><strong>–§—É–Ω–∫—Ü—ñ—ó:</strong> ${form.features || '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö'}</p>`;
                    
                    // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
                    if (form.dynamic_test_result && form.dynamic_test_result.systematic_analysis) {
                        // –ù–æ–≤–∏–π —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑
                        const testResult = form.dynamic_test_result;
                        
                        html += `
                            <div style="margin: 10px 0; padding: 15px; background: #e8f4fd; border-radius: 6px; border: 1px solid #bee5eb;">
                                <h6 style="margin: 0 0 10px 0; color: #0c5460;">üî¨ –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø–æ–º–∏–ª–æ–∫:</h6>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                    <div><strong>–ü–æ–ª—ñ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ:</strong> ${testResult.total_fields || 0}</div>
                                    <div><strong>–ü–æ–ª—ñ–≤ –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é:</strong> ${testResult.supported_fields || 0}</div>
                                </div>
                                
                                <h6 style="margin: 10px 0 5px 0; color: #0c5460;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ—Ç–æ–¥—ñ–≤ –≤–∏—è–≤–ª–µ–Ω–Ω—è:</h6>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9em;">
                        `;
                        
                        const detectionStats = testResult.detection_statistics || {};
                        const statLabels = {
                            'html5_api': 'HTML5 API',
                            'aria_support': 'ARIA –ø—ñ–¥—Ç—Ä–∏–º–∫–∞', 
                            'dom_changes': 'DOM –∑–º—ñ–Ω–∏',
                            'css_states': 'CSS —Å—Ç–∞–Ω–∏'
                        };
                        
                        Object.entries(statLabels).forEach(([key, label]) => {
                            const count = detectionStats[key] || 0;
                            const total = testResult.total_fields || 1;
                            const percentage = ((count / total) * 100).toFixed(0);
                            const color = count > 0 ? '#28a745' : '#6c757d';
                            
                            html += `
                                <div style="color: ${color};">
                                    <strong>${label}:</strong> ${count}/${total} (${percentage}%)
                                </div>
                            `;
                        });
                        
                        html += `</div>`;
                        
                        // –î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø–æ–ª—ñ–≤
                        const fieldResults = testResult.field_results || [];
                        if (fieldResults.length > 0) {
                            html += `
                                <h6 style="margin: 15px 0 8px 0; color: #0c5460;">üîç –î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø–æ–ª—ñ–≤:</h6>
                                <div style="max-height: 300px; overflow-y: auto;">
                            `;
                            
                            fieldResults.forEach((field, index) => {
                                const fieldName = field.selector || `field-${index + 1}`;
                                const fieldType = field.type || 'unknown';
                                const fieldQuality = (field.quality_score * 100).toFixed(1);
                                const isSupported = field.overall_support;
                                const statusIcon = isSupported ? '‚úÖ' : '‚ùå';
                                const bgColor = isSupported ? '#d4edda' : '#f8d7da';
                                
                                html += `
                                    <div style="margin: 8px 0; padding: 10px; background: ${bgColor}; border-radius: 4px; border: 1px solid #dee2e6;">
                                        <div style="font-weight: bold; margin-bottom: 5px;">
                                            ${statusIcon} ${fieldName} (${fieldType}) - ${fieldQuality}%
                                        </div>
                                `;
                                
                                // –ü–æ–∫–∞–∑—É—î–º–æ –º–µ—Ç–æ–¥–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—è –¥–ª—è —Ü—å–æ–≥–æ –ø–æ–ª—è
                                const detection = field.error_detection_summary || {};
                                const activeMethods = [];
                                Object.entries(statLabels).forEach(([key, label]) => {
                                    if (detection[key]) {
                                        activeMethods.push(label);
                                    }
                                });
                                
                                if (activeMethods.length > 0) {
                                    html += `
                                        <div style="font-size: 0.85em; color: #495057; margin-bottom: 5px;">
                                            <strong>–ú–µ—Ç–æ–¥–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—è:</strong> ${activeMethods.join(', ')}
                                        </div>
                                    `;
                                }
                                
                                // –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ü–µ–Ω–∞—Ä—ñ—ó —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
                                const scenarios = field.test_scenarios || [];
                                if (scenarios.length > 0) {
                                    html += `
                                        <div style="font-size: 0.85em; color: #6c757d;">
                                            <strong>–°—Ü–µ–Ω–∞—Ä—ñ—ó (${scenarios.length}):</strong>
                                    `;
                                    
                                    scenarios.forEach(scenario => {
                                        const scenarioInfo = scenario.scenario || {};
                                        const detected = scenario.error_detected;
                                        const scenarioQuality = (scenario.quality_score * 100).toFixed(0);
                                        const detectIcon = detected ? 'üîç' : '‚ö™';
                                        
                                        html += `
                                            <div style="margin-left: 10px;">
                                                ${detectIcon} ${scenarioInfo.description || 'Unknown'} (${scenarioQuality}%)
                                            </div>
                                        `;
                                    });
                                    
                                    html += `</div>`;
                                }
                                
                                html += `</div>`;
                            });
                            
                            html += `</div>`;
                        }
                        
                        html += `</div>`;
                    } else if (form.dynamic_breakdown) {
                        // –°—Ç–∞—Ä–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
                        html += `
                            <div style="margin: 10px 0; padding: 10px; background: #fff3cd; border-radius: 4px; border: 1px solid #ffeaa7;">
                                <h6 style="margin: 0 0 8px 0; color: #856404;">üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:</h6>
                        `;
                        
                        Object.entries(form.dynamic_breakdown).forEach(([category, data]) => {
                            const score = (typeof data.score === 'number' && !isNaN(data.score)) ? (data.score * 100).toFixed(1) : '0.0';
                            html += `
                                <div style="margin: 4px 0; font-size: 0.9em;">
                                    <strong>${category}:</strong> ${score}% - ${data.description || '–ù–µ–º–∞—î –æ–ø–∏—Å—É'}
                                </div>
                            `;
                        });
                        
                        html += `</div>`;
                    }
                    
                    html += `
                    `;
                    
                    if (form.field_details && form.field_details.length > 0) {
                        html += `<h6 style="margin: 15px 0 10px 0;">–ü–æ–ª—è (${form.field_details.length}):</h6>`;
                        
                        form.field_details.forEach(field => {
                            const fieldName = field.name || 'unnamed';
                            const fieldType = field.type || 'unknown';
                            const fieldQualityScore = (typeof field.quality_score === 'number' && !isNaN(field.quality_score)) 
                                ? (field.quality_score * 100).toFixed(1) 
                                : '0.0';
                            
                            html += `
                                <div style="margin: 10px 0; padding: 12px; background: white; border-radius: 6px; border: 1px solid #ddd;">
                                    <h6 style="margin: 0 0 8px 0; color: #2c3e50;">üîç ${fieldName} (${fieldType})</h6>
                                    <p style="margin: 5px 0;"><strong>–ó–∞–≥–∞–ª—å–Ω–∞ —è–∫—ñ—Å—Ç—å:</strong> ${fieldQualityScore}%</p>
                            `;
                            
                            // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ñ–∞–∑–æ–≤–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É
                            const features = field.features;
                            if (features) {
                                ['phase1', 'phase2', 'phase3'].forEach(phaseName => {
                                    const phase = features[phaseName];
                                    if (phase) {
                                        const phaseScore = (typeof phase.score === 'number' && !isNaN(phase.score)) 
                                            ? (phase.score * 100).toFixed(1) 
                                            : '0.0';
                                        const maxScore = (typeof phase.max_score === 'number' && !isNaN(phase.max_score)) 
                                            ? (phase.max_score * 100).toFixed(1) 
                                            : '0.0';
                                        
                                        html += `
                                            <div style="margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                                                <h6 style="margin: 0 0 5px 0; color: #495057;">üìå ${phase.title || phaseName}</h6>
                                                <p style="margin: 3px 0; font-size: 0.9em;"><strong>–°–∫–æ—Ä:</strong> ${phaseScore}%/${maxScore}%</p>
                                                <p style="margin: 3px 0; font-size: 0.9em; color: #6c757d;">${phase.description || ''}</p>
                                        `;
                                        
                                        // –î–µ—Ç–∞–ª—ñ –∫–æ–∂–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó
                                        if (phase.details && phase.details.length > 0) {
                                            phase.details.forEach(detail => {
                                                const statusIcon = {
                                                    'success': '‚úÖ',
                                                    'warning': '‚ö†Ô∏è',
                                                    'error': '‚ùå',
                                                    'missing': '‚ùå',
                                                    'info': '‚ÑπÔ∏è'
                                                }[detail.status] || '‚ùì';
                                                
                                                const detailScore = (typeof detail.score === 'number' && !isNaN(detail.score)) 
                                                    ? (detail.score * 100).toFixed(1) 
                                                    : '0.0';
                                                
                                                html += `
                                                    <div style="margin: 5px 0; padding: 6px; background: white; border-radius: 3px; font-size: 0.85em;">
                                                        <strong>${statusIcon} ${detail.feature || 'Unknown'}:</strong> ${detailScore}%<br>
                                                        <span style="color: #6c757d;">${detail.description || ''}</span><br>
                                                `;
                                                
                                                if (detail.explanation) {
                                                    html += `<span style="color: #007bff; font-style: italic;">üí° ${detail.explanation}</span><br>`;
                                                }
                                                
                                                html += `</div>`;
                                            });
                                        }
                                        
                                        html += `</div>`;
                                    }
                                });
                            }
                            
                            html += `</div>`;
                        });
                    }
                    
                    html += `</div>`;
                });
            }
            
            // –ü—Ä–æ–±–ª–µ–º–Ω—ñ —Ñ–æ—Ä–º–∏
            if (errorData.problematic_forms && errorData.problematic_forms.length > 0) {
                html += `
                    <p><strong>‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ñ —Ñ–æ—Ä–º–∏ (${errorData.problematic_forms.length}):</strong></p>
                `;
                errorData.problematic_forms.forEach((form, index) => {
                    const formSelector = form.selector || 'form';
                    const qualityScore = (typeof form.quality_score === 'number' && !isNaN(form.quality_score)) 
                        ? (form.quality_score * 100).toFixed(1) 
                        : '0.0';
                    
                    html += `
                        <div style="margin: 15px 0; padding: 15px; background: #ffeaea; border-radius: 8px; border-left: 4px solid #e74c3c;">
                            <h5 style="margin: 0 0 10px 0; color: #e74c3c;">üìã ${formSelector}</h5>
                            <p><strong>–ó–∞–≥–∞–ª—å–Ω–∞ —è–∫—ñ—Å—Ç—å:</strong> ${qualityScore}%</p>
                    `;
                    
                    // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–æ–∑–±–∏–≤–∫—É —Å—Ç–∞—Ç–∏—á–Ω–∏–π/–¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö —Ñ–æ—Ä–º
                    if (form.static_quality !== undefined || form.dynamic_quality !== undefined) {
                        html += `<div style="margin: 8px 0; padding: 8px; background: #fff5f5; border-radius: 4px;">`;
                        if (form.static_quality !== undefined) {
                            html += `<span style="margin-right: 15px;">üìä –°—Ç–∞—Ç–∏—á–Ω–∏–π: ${(form.static_quality * 100).toFixed(1)}%</span>`;
                        }
                        if (form.dynamic_quality !== undefined) {
                            html += `<span>üß™ –î–∏–Ω–∞–º—ñ—á–Ω–∏–π: ${(form.dynamic_quality * 100).toFixed(1)}%</span>`;
                        } else if (form.dynamic_error) {
                            html += `<span style="color: #e74c3c;">‚ùå –î–∏–Ω–∞–º—ñ—á–Ω–∏–π: ${form.dynamic_error}</span>`;
                        }
                        html += `</div>`;
                    }
                    
                    html += `<p><strong>–ü—Ä–æ–±–ª–µ–º–∏:</strong> ${form.issue || '–ù–µ–≤—ñ–¥–æ–º—ñ –ø—Ä–æ–±–ª–µ–º–∏'}</p>`;
                    
                    // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö —Ñ–æ—Ä–º
                    if (form.dynamic_test_result && form.dynamic_test_result.systematic_analysis) {
                        // –ù–æ–≤–∏–π —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö —Ñ–æ—Ä–º
                        const testResult = form.dynamic_test_result;
                        
                        html += `
                            <div style="margin: 10px 0; padding: 15px; background: #f8d7da; border-radius: 6px; border: 1px solid #f5c6cb;">
                                <h6 style="margin: 0 0 10px 0; color: #721c24;">üî¨ –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ (–ø—Ä–æ–±–ª–µ–º–Ω–∞ —Ñ–æ—Ä–º–∞):</h6>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                    <div><strong>–ü–æ–ª—ñ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ:</strong> ${testResult.total_fields || 0}</div>
                                    <div><strong>–ü–æ–ª—ñ–≤ –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é:</strong> ${testResult.supported_fields || 0}</div>
                                </div>
                        `;
                        
                        // –ö–æ—Ä–æ—Ç–∫–∏–π –æ–≥–ª—è–¥ –ø—Ä–æ–±–ª–µ–º
                        const detectionStats = testResult.detection_statistics || {};
                        const totalFields = testResult.total_fields || 1;
                        const issues = [];
                        
                        if (detectionStats.html5_api === 0) issues.push("–í—ñ–¥—Å—É—Ç–Ω—è HTML5 –≤–∞–ª—ñ–¥–∞—Ü—ñ—è");
                        if (detectionStats.aria_support === 0) issues.push("–í—ñ–¥—Å—É—Ç–Ω—è ARIA –ø—ñ–¥—Ç—Ä–∏–º–∫–∞");
                        if (detectionStats.dom_changes === 0) issues.push("–ù–µ–º–∞—î DOM –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å");
                        if (detectionStats.css_states === 0) issues.push("–ù–µ–º–∞—î CSS —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä—ñ–≤");
                        
                        if (issues.length > 0) {
                            html += `
                                <div style="margin: 10px 0; padding: 8px; background: #f5c6cb; border-radius: 4px;">
                                    <strong>–û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏:</strong><br>
                                    ${issues.map(issue => `‚Ä¢ ${issue}`).join('<br>')}
                                </div>
                            `;
                        }
                        
                        html += `</div>`;
                    } else if (form.dynamic_breakdown) {
                        // –°—Ç–∞—Ä–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö —Ñ–æ—Ä–º
                        html += `
                            <div style="margin: 10px 0; padding: 10px; background: #f8d7da; border-radius: 4px; border: 1px solid #f5c6cb;">
                                <h6 style="margin: 0 0 8px 0; color: #721c24;">üß™ –î–∏–Ω–∞–º—ñ—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:</h6>
                        `;
                        
                        Object.entries(form.dynamic_breakdown).forEach(([category, data]) => {
                            const score = (typeof data.score === 'number' && !isNaN(data.score)) ? (data.score * 100).toFixed(1) : '0.0';
                            html += `
                                <div style="margin: 4px 0; font-size: 0.9em;">
                                    <strong>${category}:</strong> ${score}% - ${data.description || '–ù–µ–º–∞—î –æ–ø–∏—Å—É'}
                                </div>
                            `;
                        });
                        
                        html += `</div>`;
                    }
                    
                    html += `
                    `;
                    
                    if (form.field_details && form.field_details.length > 0) {
                        html += `<h6 style="margin: 15px 0 10px 0;">–ü–æ–ª—è (${form.field_details.length}):</h6>`;
                        
                        form.field_details.forEach(field => {
                            const fieldName = field.name || 'unnamed';
                            const fieldType = field.type || 'unknown';
                            const fieldQualityScore = (typeof field.quality_score === 'number' && !isNaN(field.quality_score)) 
                                ? (field.quality_score * 100).toFixed(1) 
                                : '0.0';
                            
                            html += `
                                <div style="margin: 10px 0; padding: 12px; background: white; border-radius: 6px; border: 1px solid #ddd;">
                                    <h6 style="margin: 0 0 8px 0; color: #2c3e50;">üîç ${fieldName} (${fieldType})</h6>
                                    <p style="margin: 5px 0;"><strong>–Ø–∫—ñ—Å—Ç—å:</strong> ${fieldQualityScore}%</p>
                            `;
                            
                            // –°–∫–æ—Ä–æ—á–µ–Ω–∏–π —Ñ–∞–∑–æ–≤–∏–π –∞–Ω–∞–ª—ñ–∑ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö —Ñ–æ—Ä–º
                            const features = field.features;
                            if (features) {
                                ['phase1', 'phase2', 'phase3'].forEach(phaseName => {
                                    const phase = features[phaseName];
                                    if (phase) {
                                        const phaseScore = (typeof phase.score === 'number' && !isNaN(phase.score)) 
                                            ? (phase.score * 100).toFixed(1) 
                                            : '0.0';
                                        
                                        const statusColor = phase.score > 0.7 ? '#27ae60' : phase.score > 0.3 ? '#f39c12' : '#e74c3c';
                                        
                                        html += `
                                            <span style="display: inline-block; margin: 2px 5px 2px 0; padding: 3px 8px; background: ${statusColor}; color: white; border-radius: 12px; font-size: 0.8em;">
                                                ${phase.title}: ${phaseScore}%
                                            </span>
                                        `;
                                    }
                                });
                            }
                            
                            html += `</div>`;
                        });
                    }
                    
                    html += `</div>`;
                });
            }
            
            if (errorData.total_forms === 0) {
                html += '<p>‚ö†Ô∏è –§–æ—Ä–º–∏ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>';
            }
            
            return html;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ DOM –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
            
            const form = document.getElementById('testForm');
            const urlInput = document.getElementById('url');
            const submitBtn = document.getElementById('submitBtn');
            const loadingDiv = document.getElementById('loading');
            const resultsDiv = document.getElementById('results');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log('üìù –§–æ—Ä–º–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞');
                
                const url = urlInput.value.trim();
                console.log('üîó URL:', url);
                
                // –ü–æ–∫–∞–∑–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                loadingDiv.style.display = 'block';
                resultsDiv.style.display = 'none';
                submitBtn.disabled = true;
                
                try {
                    console.log('üì° –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç...');
                    
                    const response = await fetch('http://localhost:8001/api/evaluate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({ url: url })
                    });
                    
                    console.log('üì® –°—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:', response.status);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    console.log('üìä –û—Ç—Ä–∏–º–∞–Ω—ñ –¥–∞–Ω—ñ:', data);
                    
                    // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
                    resultsDiv.innerHTML = `
                        <h3>‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É</h3>
                        <p><strong>URL:</strong> ${data.url}</p>
                        <p><strong>–°–∫–æ—Ä:</strong> ${(data.final_score * 100).toFixed(1)}%</p>
                        <p><strong>–†—ñ–≤–µ–Ω—å:</strong> ${data.quality_level}</p>
                        <p><strong>–û–ø–∏—Å:</strong> ${data.quality_description}</p>
                        
                        <h4>–ü—ñ–¥—Å–∫–æ—Ä–∏:</h4>
                        <ul>
                            <li>–ü–µ—Ä—Ü–µ–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å: ${(data.subscores.perceptibility * 100).toFixed(1)}%</li>
                            <li>–ö–µ—Ä–æ–≤–∞–Ω—ñ—Å—Ç—å: ${(data.subscores.operability * 100).toFixed(1)}%</li>
                            <li>–ó—Ä–æ–∑—É–º—ñ–ª—ñ—Å—Ç—å: ${(data.subscores.understandability * 100).toFixed(1)}%</li>
                            <li>–õ–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è: ${(data.subscores.localization * 100).toFixed(1)}%</li>
                        </ul>
                        
                        <h4>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó (${data.recommendations.length}):</h4>
                        <ul>
                            ${data.recommendations.map(rec => `<li>${rec.category}: ${rec.recommendation}</li>`).join('')}
                        </ul>
                        
                        <h4>–î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω–æ—ó –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó:</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0;">
                            ${formatKeyboardDetails(data.detailed_analysis?.keyboard_navigation)}
                        </div>
                        
                        <h4>–î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –ø–æ–º–∏–ª–æ–∫:</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0;">
                            ${formatErrorSupportDetails(data.detailed_analysis?.error_support)}
                        </div>
                    `;
                    resultsDiv.style.display = 'block';
                    
                } catch (error) {
                    console.error('‚ùå –ü–æ–º–∏–ª–∫–∞:', error);
                    resultsDiv.innerHTML = `<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}</div>`;
                    resultsDiv.style.display = 'block';
                } finally {
                    loadingDiv.style.display = 'none';
                    submitBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>